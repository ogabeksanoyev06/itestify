import{u as O,b as Y,a as C,c as L}from"./entry.DdJuc-3z.js";import{u as R}from"./useApi.BoEt07ES.js";import{t as r}from"./test.DmJ8w_Fl.js";import{a as i}from"./swiper-vue.DvdnvJXd.js";const F=window.setInterval,M=()=>{const h=O(),_=Y(),{$toast:l}=L(),d=R(),v=i(!1),m=i(0),u=i(1),a=i({}),f=i({}),o=i(!1),y=()=>{let e=F(()=>{if(m.value<=0){T(),clearInterval(e);return}m.value--},1e3)},b=e=>{let t=parseInt(e,10),s=Math.floor(t/3600),c=Math.floor((t-s*3600)/60),n=t-s*3600-c*60;return s<10&&(s="0"+s),c<10&&(c="0"+c),n<10&&(n="0"+n),s+":"+c+":"+n},k=e=>{a.value={subjectName:e.name,questionBall:e.ball,questionCount:e.questions.length,type:e.type,startedTime:e.time_interval.started_time,finishAt:e.time_interval.finish_at,testId:e.time_interval.id,questions:e.questions.map(t=>({id:t.id,question:t.question,answers:[t.answer1,t.answer2,t.answer3,t.answer4],correctAnswer:t.correct_answer,isPicked:t.is_picked,answer:t.answer}))}},E=e=>{a.value={subjectName:e.name,type:e.type,testId:e.time_interval.id,questions:e.questions.map(t=>({id:t.id,question:t.question,answers:[t.answer1,t.answer2,t.answer3,t.answer4],correctAnswer:t.correct_answer,isPicked:t.is_picked,answer:t.answer}))}},g=e=>{a.value={subjectName:e.name,type:e.type,testId:e.time_interval.id,questions:e.questions.map(t=>({id:t.id,question:t.question,answers:[t.answer1,t.answer2,t.answer3,t.answer4],correctAnswer:t.correct_answer,isPicked:t.is_picked,answer:t.answer}))}},N=e=>{a.value=e},A=()=>{const e=u.value-1;e>0&&w(e)},P=()=>{const e=u.value+1;e<=a.value.questions.length&&w(e)},I=()=>{const e=parseInt(h.query.testNumber||"1");u.value=e,f.value=a.value.questions[e-1]||{}},w=e=>{e!==u.value&&_.push({path:"/test",query:{testNumber:e}})},T=async()=>{let e="",t={question_id:null,total_result_id:a.value.testId,answer:null,picked:null,finishing:!0};switch(a.value.type){case r.TYPE_ONLINE:e="tests/online-test/done/";break;case r.TYPE_BLOCK:e="tests/science-test/done/";break;case r.TYPE_SCHOOL:e="tests/school-test/done/";break;case r.TYPE_RESEARCH:e="tests/researches/test/done/";break;default:console.error("Unknown test type");return}try{const s=await d.post(e,t);C("testResult",s),_.push("/test-result")}catch(s){console.log(s.response)}};return{loading:v,testTimer:m,testNumber:u,tests:a,selectedQuestion:f,hasActiveTest:o,selectedQuestions:I,setTimer:y,timerFormat:b,prev:A,next:P,getActiveTestNumber:w,testFinish:T,selectAnswer:async(e,t)=>{let s="",c={question_id:Number(e),total_result_id:a.value.testId,answer:t,picked:!0,finishing:!1};switch(a.value.type){case r.TYPE_ONLINE:s="tests/online-test/done/";break;case r.TYPE_BLOCK:s="tests/science-test/done/";break;case r.TYPE_SCHOOL:s="tests/school-test/done/";break;case r.TYPE_RESEARCH:s="tests/researches/test/done/";break;default:console.error("Unknown test type");return}try{const n=await d.post(s,c);n.code===200&&(l.success(n.message),a.value.questions.forEach(p=>{p.id===e&&(p.isPicked=!0,p.answer=t)}))}catch(n){l.error(n.response.data.message)}},getTestLiveTime:async()=>{try{const e=await d.post("tests/get-test-live-time/",{test_type:a.value.type,test_id:a.value.testId});e.code===200&&(l.success(e.message),m.value=e.data.left_time*60)}catch(e){l.error(e.response.data.message)}},getActiveTest:async e=>{v.value=!0;try{const t=await d.get("tests/active-tests/",e);switch(t.type){case r.TYPE_BLOCK:k(t),o.value=!0;break;case r.TYPE_SCHOOL:E(t),o.value=!0;break;case r.TYPE_RESEARCH:g(t),o.value=!0;break;case r.TYPE_ONLINE:N(t),o.value=!0;break;default:o.value=!1;break}}catch(t){l.error(t.response.data.message),console.log("sassa",t)}finally{v.value=!1}}}};export{M as u};
